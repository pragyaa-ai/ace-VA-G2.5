<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini Live API - Vanilla JS Example</title>
    <style>
      :root {
        /* Google Brand Colors */
        --google-blue: #4285f4;
        --google-red: #db4437;
        --google-yellow: #f4b400;
        --google-green: #0f9d58;
      }

      body {
        font-family: Arial, sans-serif;
        transition: all 0.5s ease-in-out;
      }

      .container {
        display: flex;
        gap: 20px;
      }
      .left-column {
        flex: 1;
      }
      .right-column {
        flex: 1;
      }

      #setupJsonDisplay {
        background-color: #f4f4f4;
        padding: 10px;
        overflow-x: auto;
        white-space: pre-wrap;
      }

      .user-transcript:before {
        content: "USER SPEECH: ";
        background-color: var(--google-yellow);
        color: black;
      }

      .user::before {
        content: "USER: ";
        background-color: var(--google-green);
        color: white;
      }

      .assistant:before {
        content: "GEMINI SPEECH: ";
        background-color: var(--google-blue);
        color: white;
      }

      .system:before {
        content: "SYSTEM: ";
        background-color: var(--google-red);
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>Gemini Live API - Vanilla JS Example</h1>
    <p>
      Vanilla JavaScript implementation with audio, video, and text streaming
    </p>

    <div class="container">
      <!-- Left Column: API Configuration -->
      <div class="left-column">
        <!-- Connection Setup -->
        <section>
          <h2>API Configuration</h2>

          <!-- Connection Settings -->
          <details open>
            <summary>Connection Settings</summary>
            <div>
              <label for="proxyUrl">Proxy WebSocket URL:</label><br />
              <input
                type="text"
                id="proxyUrl"
                placeholder="wss://singleinterfacews.pragyaa.ai/geminiWs"
                value="wss://singleinterfacews.pragyaa.ai/geminiWs" />
            </div>

            <div>
              <label for="projectId">Project ID:</label><br />
              <input type="text" id="projectId" value="voiceagentprojects" />
            </div>

            <div>
              <label for="model">Model ID:</label><br />
              <input
                type="text"
                id="model"
                value="gemini-live-2.5-flash-native-audio"
                placeholder="Enter model ID" />
            </div>
          </details>

          <!-- Gemini Behavior Settings -->
          <br />
          <details open>
            <summary>Gemini Behavior</summary>
            <div>
              <label for="systemInstructions">System Instructions:</label><br />
              <textarea id="systemInstructions" rows="3" cols="50">
Agent Overview
Agent Name: USV Exit Interview Scheduler
Voice: shimmer (female voice)
Role: North Indian female assistant at AceNgage
Purpose: Schedule exit interviews for USV employees with HR counsellor

Critical Features
1. INDIAN ACCENT (MANDATORY)
Distinct North Indian accent; rolled "r", clear vowels, dental "t/d", sing-song intonation.
Sound human: smile while speaking, vary pitch, use fillers like "Oh!", "Wonderful!", "Perfect!", show empathy.

2. LANGUAGE SUPPORT (ENGLISH/HINDI)
Start in English. Detect first meaningful response:
- Hindi sentence (4+ words) -> LOCK TO HINDI for entire call.
- English -> stay in English.
Never switch after lock. Ignore single words, names, emails, numbers.

3. GREETING & INTENT
English: "Hello. This call is from AceNgage on behalf of USV. We would like to schedule your exit interview with an HR counsellor. May I take a few moments to find a convenient time for you?"
Hindi: "Namaste. Yeh call AceNgage ki taraf se USV ke liye hai. Hum aapka exit interview ek HR counsellor ke saath schedule karna chahte hain. Kya main aapke liye ek convenient time dhundh sakti hoon?"

4. WHY OBJECTION
English: "The exit interview is an opportunity for you to share your feedback and experience with USV. This helps the company understand what worked well and what can be improved for future employees. Your insights are valuable and will help USV make positive changes. Please note that your feedback is kept anonymous."
Hindi: "Exit interview aapko ek mauka deta hai apna feedback aur experience USV ke saath share karne ka. Isse company ko samajh aata hai ki kya achha raha aur kya improve kiya ja sakta hai future employees ke liye. Aapki insights bahut valuable hain aur USV ko positive changes karne mein madad karengi. Dhyan dijiye ki aapka feedback anonymous rakha jaata hai."

5. DATA COLLECTION
Ask date+time together.
English: "What date and time would work best for you for the exit interview?"
Hindi: "Exit interview ke liye aapke liye kaun sa date aur time best rahega?"
If only date: ask time.
Immediate request ("now/abhi"): schedule 2 hours from current time and confirm.
Never schedule past time. If past: ask for a future date/time.

6. CONFIRMATION
After "Yes", confirm immediately:
English: "Great, you are all set. You will get a call from an HR counsellor on [Date] at [Time]. Please be in a quiet area and ensure good coverage."
Hindi: "Bahut achha, aap ready hain. Aapko [Date] ko [Time] par ek HR counsellor se call aayegi. Kripya ek shaant jagah mein rahein aur achha network coverage ensure karein."

7. OBJECTIONS -> END CALL
If any objection below, respond and end the call:
1. "I'm not interested"
2. "I don't want to share feedback"
3. "I have nothing to say"
4. "Please don't call"
5. "Please don't disturb"
6. "Please stop calling"
7. "HR is already aware, I do not want to discuss anything"
8. "How will I know of the improvements as I have already left"
9. "What will I get out of this. I don't want to waste my 15 mins"
10. "It's been too long since I left. Please don't call"
11. "F&F settlement not done. I don't want to discuss anything before that"
12. "Had bad experience and I don't want to discuss"
13. "On a medical emergency. Please don't call"
English: "Ok, we will end this call now. Thanks."
Hindi: "Theek hai, hum yeh call ab khatam karte hain. Dhanyawad."

8. ERROR HANDLING
Silence timeout 12s. Max 3 re-prompts per data point.
After 2 failed attempts: "I want to make sure I get this right. Would you like me to call back later?"
Unclear:
English: "I'm sorry, I didn't quite catch that. Could you please repeat?"
Hindi: "Maaf kijiye, main samajh nahi payi. Kya aap dobara keh sakte hain?"

Conversation Flow
1) Greeting (English) -> detect language
2) Handle "Why?" if asked
3) Collect date + time (ensure future)
4) Confirm and close
OR objection -> respond and end

Key Traits
Respectful, empathetic, professional; soft, warm, conversational; distinct North Indian accent; patient and accommodating.</textarea
              >
            </div>

            <div>
              <label for="voiceSelect">Voice:</label><br />
              <select id="voiceSelect">
                <option value="Puck">Puck</option>
                <option value="Charon">Charon</option>
                <option value="Kore" selected>Kore (Default)</option>
                <option value="Fenrir">Fenrir</option>
                <option value="Aoede">Aoede</option>
              </select>
            </div>

            <div>
              <label for="temperature"
                >Temperature: <span id="temperatureValue">1.0</span></label
              ><br />
              <input
                type="range"
                id="temperature"
                min="0.1"
                max="2.0"
                step="0.1"
                value="1.0" />
              <br />
              <small
                >Controls randomness (0.0-2.0]. Higher = more creative/diverse,
                Lower = more predictable/focused</small
              >
            </div>

            <div>
              <input type="checkbox" id="enableProactiveAudio" checked />
              <label for="enableProactiveAudio"
                >Enable proactive audio (Gemini will ignore speech based on
                instructions)</label
              >
            </div>

            <div>
              <input type="checkbox" id="enableGrounding" />
              <label for="enableGrounding"
                >Enable Google grounding (Enabling Google grounding will disable
                custom tools)
              </label>
            </div>

            <div>
              <input type="checkbox" id="enableAffectiveDialog" checked />
              <label for="enableAffectiveDialog"
                >Enable affective dialog (emotion detection and empathetic
                responses)</label
              >
            </div>
          </details>

          <!-- Custom Tools -->
          <br />
          <details>
            <summary>Custom Tools</summary>

            <div>
              <input type="checkbox" id="enableAlertTool" checked />
              <label for="enableAlertTool">Show Alert Box</label>
              <span> (Display browser alerts) </span>
            </div>

            <div>
              <input type="checkbox" id="enableCssStyleTool" checked />
              <label for="enableCssStyleTool">Add CSS Style</label>
              <span> (Inject CSS styles into the page) </span>
            </div>
          </details>

          <!-- Transcription Settings -->
          <br />
          <details>
            <summary>Transcription Settings</summary>
            <div>
              <input type="checkbox" id="enableInputTranscription" checked />
              <label for="enableInputTranscription"
                >Enable input transcription (your speech)</label
              >
            </div>

            <div>
              <input type="checkbox" id="enableOutputTranscription" checked />
              <label for="enableOutputTranscription"
                >Enable output transcription (Gemini responses)</label
              >
            </div>
          </details>

          <!-- Activity Detection Settings -->
          <br />
          <details>
            <summary>Activity Detection Settings</summary>
            <div>
              <input type="checkbox" id="disableActivityDetection" />
              <label for="disableActivityDetection"
                >Disable automatic activity detection</label
              >
            </div>

            <div>
              <label for="silenceDuration">Silence duration (ms):</label><br />
              <input
                type="number"
                id="silenceDuration"
                value="500"
                min="500"
                max="10000"
                step="100" />
            </div>

            <div>
              <label for="prefixPadding">Prefix padding (ms):</label><br />
              <input
                type="number"
                id="prefixPadding"
                value="500"
                min="0"
                max="2000"
                step="100" />
            </div>

            <div>
              <label for="endSpeechSensitivity"
                >End of speech sensitivity:</label
              ><br />
              <select id="endSpeechSensitivity">
                <option value="END_SENSITIVITY_UNSPECIFIED" selected>
                  Default
                </option>
                <option value="END_SENSITIVITY_HIGH">
                  High (quicker cutoff)
                </option>
                <option value="END_SENSITIVITY_LOW">Low (longer wait)</option>
              </select>
            </div>

            <div>
              <label for="startSpeechSensitivity"
                >Start of speech sensitivity:</label
              ><br />
              <select id="startSpeechSensitivity">
                <option value="START_SENSITIVITY_UNSPECIFIED" selected>
                  Default
                </option>
                <option value="START_SENSITIVITY_HIGH">
                  High (quicker detection)
                </option>
                <option value="START_SENSITIVITY_LOW">
                  Low (more filtering)
                </option>
              </select>
            </div>

            <div>
              <label for="activityHandling">Activity Handling:</label><br />
              <select id="activityHandling">
                <option value="ACTIVITY_HANDLING_UNSPECIFIED" selected>
                  Default (Interrupts)
                </option>
                <option value="START_OF_ACTIVITY_INTERRUPTS">
                  Interrupt (Barge-in)
                </option>
                <option value="NO_INTERRUPTION">No Interruption</option>
              </select>
            </div>
          </details>

          <br />

          <div>
            <button id="connectBtn">Connect</button>
            <button id="disconnectBtn">Disconnect</button>
          </div>

          <br />

          <div id="connectionStatus">Not connected</div>

          <br />

          <!-- Setup Message JSON Display -->
          <details id="setupJsonSection" style="display: none">
            <summary>
              Setup Message JSON (raw config sent to Gemini API)
            </summary>
            <pre id="setupJsonDisplay"></pre>
          </details>
        </section>
      </div>

      <!-- Right Column: Media and Chat -->
      <div class="right-column">
        <!-- Media Controls -->
        <section>
          <h2>Media Streaming</h2>

          <div class="container">
            <div class="left-column">
              <!-- Device Selectors -->
              <div style="margin-bottom: 10px">
                <div style="margin-bottom: 5px">
                  <label for="micSelect">Microphone:</label><br />
                  <select id="micSelect" style="width: 100%; max-width: 300px">
                    <option value="">Default Microphone</option>
                  </select>
                </div>

                <div style="margin-bottom: 10px">
                  <label for="cameraSelect">Camera:</label><br />
                  <select
                    id="cameraSelect"
                    style="width: 100%; max-width: 300px">
                    <option value="">Default Camera</option>
                  </select>
                </div>
              </div>

              <div>
                <button id="startAudioBtn">Start Audio</button>
                <button id="startVideoBtn">Start Video</button>
                <button id="startScreenBtn">Share Screen</button>
              </div>

              <br />
              <div>
                <label for="volume">Output volume:</label>
                <input type="range" id="volume" min="0" max="100" value="80" />
                <span id="volumeValue">80%</span>
              </div>
            </div>

            <div class="right-column">
              <video
                id="videoPreview"
                autoplay
                playsinline
                muted
                hidden
                width="400"></video>
            </div>
          </div>
        </section>

        <!-- Chat Interface -->
        <section>
          <h2>Chat</h2>

          <div
            id="chatContainer"
            style="
              border: 1px solid;
              height: 300px;
              overflow-y: auto;
              padding: 10px;
            ">
            <div>Connect to Gemini to start chatting</div>
          </div>
          <br />
          <div>
            <input
              type="text"
              id="chatInput"
              placeholder="Type a message..."
              autocomplete="off" />
            <button id="sendBtn">Send</button>
          </div>
        </section>

        <!-- Debug Info -->
        <section>
          <h2>Debug Info</h2>
          <pre id="debugInfo">Ready to connect...</pre>
        </section>
      </div>
    </div>

    <!-- Load libraries -->
    <script src="geminilive.js"></script>
    <script src="mediaUtils.js"></script>
    <script src="tools.js"></script>
    <script src="script.js"></script>
  </body>
</html>
